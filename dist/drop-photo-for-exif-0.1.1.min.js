/*!
  * drop-photo-for-exif v0.1.1 (https://github.com/migupl/drop-photo-get-exif-data)
  * Licensed under MIT (https://github.com/migupl/drop-photo-get-exif-data/blob/main/LICENSE)
  */
(e=>{class t extends HTMLElement{#e;constructor(){super();const e=this.attachShadow({mode:"closed"});this.#e=this.#t(e),this.#i(),this.#e.processFiles()}connectedCallback(){const e=document.createElement("style");e.textContent=this.#e.style;const t=document.createElement("div");t.className="item",t.innerHTML=this.#e.icon;const i=document.createElement("input");i.type="file",i.multiple="multiple",i.onchange=e=>{const t=Array.from(i.files);this.#o(t)};const o=document.createElement("span");o.role="button",o.className="upload",o.textContent=this.#e.uploadText,o.onclick=e=>i.click();const n=document.createElement("div");n.className="item",n.textContent=this.#e.dragText+" ",n.appendChild(o);const a=document.createElement("div");a.id="drag-text-area",a.appendChild(t),a.appendChild(n);const s=document.createElement("div");s.id="drag-area",s.style="display: none;";const l=this.#e.shadow;l.appendChild(e),l.appendChild(a),l.appendChild(s)}#n=function(e=((e,t)=>console.log("Do something after image is ready")),t=(e=>console.log("Do something after file is ready")),i=(()=>console.log("Do something on complete"))){const o={geojson:"application/geo+json",jfif:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",pjpeg:"image/jpeg",pjp:"image/jpeg",png:"image/png",tiff:"image/tiff",tif:"image/tiff",webp:"image/webp"};let n=0;const a=e=>{const t=e.split(".").pop();return o[t]||""},s=e=>({directory:null!=e.lastModified?void 0:(e?.isDirectory&&e)??(e?.webkitGetAsEntry().isDirectory&&e.webkitGetAsEntry()),file:(e.name&&e)??(e?.webkitGetAsEntry().isFile&&e.getAsFile())}),l=e=>{--n;const t=e.filter((e=>e.isDirectory));r(t);e.filter((e=>e.isFile)).forEach((e=>e.file(d)))},d=async o=>{++n;const s=o.type?o:new File([o],o.name,{type:a(o.name)}),l=s.type.startsWith("image/")&&await(e=>ExifReader.load(e).then((e=>{let t={details:e};if(e.GPSLatitude&&e.GPSLatitudeRef&&e.GPSLongitude&&e.GPSLongitudeRef&&(t.location={latitude:`${e.GPSLatitude.description} ${e.GPSLatitudeRef.value[0]}`,longitude:`${e.GPSLongitude.description} ${e.GPSLongitudeRef.value[0]}`},e.GPSAltitude)){const[i,o]=e.GPSAltitude.value;t.location.altitude=i/o}return t})))(s);((o,a)=>{a?e(o,a):t(o),--n,n||i()})(s,l)},r=e=>{for(let i of e){const e=s(i);e.directory?(t=e.directory,++n,t.createReader().readEntries(l)):d(e.file)}var t};return{process:r}};#t=e=>{const t="#E8E8E8",i="Drag files here or",o="upload files",n=(e=!0)=>{const t=this.#e.shadow.getElementById("drag-text-area"),i=this.#e.shadow.getElementById("drag-area");e?(t.style="display: none",i.style="display: flex"):(t.style="display: flex",i.style="display: none")},a=this.getAttribute("drag-area-background")||t;return{dragText:this.getAttribute("drag-text")||i,uploadText:this.getAttribute("upload-text")||o,icon:`<svg viewBox="0 0 59 49" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="40.772121" height="31.674221" x="0.614479" y="12.7783" fill="${a}" /><path fill-rule="evenodd" clip-rule="evenodd" d="M0.614479 12.7783L6.74988 12.7783L6.74988 14.7158L2.55198 14.7158L2.55198 18.9137L0.614479 18.9137L0.614479 12.7783Z" fill="#000000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M39.3644 42.4866L39.3644 38.2887L41.3019 38.2887L41.3019 44.4241L35.1665 44.4241L35.1665 42.4866L39.3644 42.4866Z" fill="#000000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M0.614479 38.2887L2.55198 38.2887L2.55198 42.4866L6.74987 42.4866L6.74987 44.4241L0.614479 44.4241L0.614479 38.2887Z" fill="#000000"></path><path d="M19.6665 30.2531H58.4165L58.4165 0.544722H19.6665L19.6665 30.2531Z" fill="#379fe5"></path><path d="M19.6665 21.8429L19.6665 30.2525L58.4168 30.2525L58.4168 19.7406L49.6667 12.4069C48.6234 11.5342 47.2931 11.0699 45.9272 11.1018C44.5614 11.1337 43.2547 11.6596 42.2542 12.5801L33.4166 20.7918L28.4166 17.2548C27.7332 16.7781 26.9013 16.5563 26.0684 16.6288C25.2354 16.7012 24.4554 17.0632 23.8666 17.6505L19.6665 21.8429Z" fill="#145207"></path><path d="M30.0056 12.9386C31.7315 12.9386 33.1306 11.5395 33.1306 9.8136C33.1306 8.08773 31.7315 6.68863 30.0056 6.68863C28.2798 6.68863 26.8807 8.08773 26.8807 9.8136C26.8807 11.5395 28.2798 12.9386 30.0056 12.9386Z" fill="#F2DF2E"></path></svg>`,processFiles:()=>{this.addEventListener("drop",(e=>{n(!1);const{items:t}=e.dataTransfer;this.#o(t)})),this.addEventListener("dragenter",(e=>{n()})),this.addEventListener("dragleave",(e=>{n(!1)}))},shadow:e,style:`:host #drag-text-area {display: flex;flex-wrap: wrap;justify-content: center;align-items: center;}#drag-area {height: 100%;background: ${a}}.item {margin: 10px;}div svg {min-width: 50px;}div > * {position: relative;}.upload {color: blue;cursor: pointer;}.upload:hover {text-decoration: underline;}`}};#o=e=>{const t=e=>this.#e.shadow.dispatchEvent(e),i=(e,t)=>{const i={bubbles:!0,composed:!0};return t?i.detail={name:e.name,image:e,location:t.location,exif:t.details}:e&&(i.detail=e),i};this.#n(((e,o)=>t(new CustomEvent("drop-photo-for-exif:image",i(e,o)))),(e=>t(new CustomEvent("drop-photo-for-exif:file",i(e)))),(()=>t(new CustomEvent("drop-photo-for-exif:completed-batch",i())))).process(e)};#i=()=>{const e=e=>{e.stopPropagation(),e.preventDefault()};["dragenter","dragover","dragleave","drop"].forEach((t=>{this.addEventListener(t,e,!1)}))}}let i=document.createElement("script");i.src="https://cdn.jsdelivr.net/npm/exifreader@4.12.0/dist/exif-reader.min.js",i.onload=function(e){customElements.define("drop-photo-for-exif",t),i=null},document.body.append(i)})();
